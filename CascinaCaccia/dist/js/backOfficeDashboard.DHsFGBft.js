import"./modulepreload-polyfill.B5Qt9EMX.js";import{c as P,g as w,s as N,d as A}from"./api.D7kNI4Xz.js";import{i as R}from"./navbar.DKoGiJDT.js";import"./utils.DWPHOh8N.js";const d=sessionStorage.getItem("authToken");if(!d)window.location.href="../index.html";else{let T=function(){d&&(console.log(d),A(d))};console.log("ok"),console.log("Token trovato, invio al server...");const k=await P(d);console.log(k);const S=document.getElementById("navbar-menu"),i=document.createElement("ul");if(S?.appendChild(i),R(),k.status==200){const a=document.createElement("li"),l=document.createElement("a");l.href="../Pages/dashboard.html",l.textContent="Dashboard",a.appendChild(l),i?.appendChild(a),a.classList.add("navbar-link");const c=document.createElement("li"),o=document.createElement("a");o.href="../Pages/registrationUser.html",o.textContent="Registra Nuova Utenza",c.appendChild(o),i?.appendChild(c),c.classList.add("navbar-link");const m=document.createElement("li"),t=document.createElement("a");t.href="../Pages/registrationMail.html",t.textContent="Modifica Mail Cascina",m.appendChild(t),i?.appendChild(m),m.classList.add("navbar-link")}const h=document.createElement("li"),g=document.createElement("a");g.id="mailLink",g.textContent="Scarica Mail",g.addEventListener("click",T),h.appendChild(g),i?.appendChild(h),h.classList.add("navbar-link");const C=document.createElement("li"),E=document.createElement("a");E.id="logoutBtn",E.href="../Pages/logout.html",E.textContent="Logout",C.appendChild(E),i?.appendChild(C),C.classList.add("navbar-link"),w(d).then(a=>{const l=document.getElementById("card-container"),c=document.getElementById("card-container-right"),o=document.getElementById("modal"),m=document.querySelector(".close");if(!l||!c){console.error("Uno o entrambi i container per le card non sono stati trovati.");return}Array.isArray(a)?(a.sort((t,e)=>{const y=new Date(t.contactDate);return new Date(e.contactDate).getTime()-y.getTime()}),a.forEach(t=>{if(t.formType==="FORM_BOOKING"){const e=document.createElement("div");e.className="card",e.id=`prenotazione-${t.id}`;const y=document.createElement("h3");y.textContent=`${t.name} ${t.surname}`;const p=document.createElement("p");p.textContent=`Email: ${t.email}`;const L=document.createElement("p");L.textContent=`${t.association}`;const f=document.createElement("div");f.classList.add("card-footer");const s=document.createElement("div");s.classList.add("status-box"),f.appendChild(s);const b=document.createElement("p"),v=new Date(t.contactDate).toLocaleDateString("it-IT");b.classList.add("date"),b.textContent=`${v}`,e.appendChild(b),e.appendChild(y),e.appendChild(L),e.appendChild(p),e.appendChild(f),e.addEventListener("click",()=>{o.style.display="flex",document.getElementById("modal-title").textContent=`${t.name} ${t.surname}`,document.getElementById("modal-association").textContent=`${t.association}`,document.getElementById("modal-contact-date").textContent=`in data ${v}`,document.getElementById("modal-prenotation-date").textContent=`${t.beginTime} - ${t.endTime}`,document.getElementById("modal-booking-duration").textContent=`${t.bookingDuration.name} - ${t.bookingDuration.description}`,document.getElementById("modal-quantity").textContent=`${t.participantsQuantity} partecipanti, ${t.guidesQuantity} tutor`;const x=document.getElementById("modal-email");x.textContent=`${t.email}`,x.href=`mailto:${t.email}`;const B=document.getElementById("modal-phone-number");B.textContent=`${t.phoneNumber}`,B.href=`tel:${t.phoneNumber}`;const M=document.getElementById("modal-activity-type");M.innerHTML="",t.activityType.forEach(n=>{const r=document.createElement("p");r.textContent=`${n.name}`,M.appendChild(r)}),document.getElementById("modal-additional-info").textContent=`${t.additionalInfo||"Nessuna"}`;const I=document.getElementById("modal-buttons");I.innerHTML="",t.bookingStatus==="PENDING"?I.innerHTML=`
                            <button id="close-modal">Rifiuta</button>
                            <button id="confirm-booking">Conferma</button>`:t.bookingStatus==="CONFIRMED"&&(I.innerHTML=`
                            <button id="cancel-booking">Cancella Prenotazione</button>`),m.addEventListener("click",()=>{o.style.display="none"});function $(){const n=document.getElementById("loading-modal");n&&(n.style.display="flex")}function D(){const n=document.getElementById("loading-modal");n&&(n.style.display="none")}document.getElementById("confirm-booking")?.addEventListener("click",async()=>{o.style.display="none",$();const n={id:t.id,bookingStatus:"CONFIRMED"};try{await N(n,d),location.reload()}catch(r){console.error("Errore durante la conferma della prenotazione:",r);const u=document.getElementById("text-error");u&&(u.textContent="Si è verificato un errore,  riprova a eseguire l'operazione")}finally{setTimeout(()=>{D()},5e3)}}),document.getElementById("cancel-booking")?.addEventListener("click",async()=>{o.style.display="none",$();const n={id:t.id,bookingStatus:"PENDING"};try{await N(n,d),location.reload()}catch(r){console.error("Errore durante la conferma della prenotazione:",r);const u=document.getElementById("text-error");u&&(u.textContent="Si è verificato un errore, riprova a eseguire l'operazione")}finally{setTimeout(()=>{D()},5e3)}}),document.getElementById("close-modal")?.addEventListener("click",()=>{o.style.display="none"})}),t.bookingStatus==="PENDING"?(l.appendChild(e),s.textContent="DA CONFERMARE",s.classList.add("pending")):t.bookingStatus==="CONFIRMED"&&(c.appendChild(e),s.textContent="CONFERMATO",s.classList.add("confirmed"))}})):console.log("I dati ricevuti non sono un array.")}).catch(a=>{console.error("Errore durante il caricamento delle prenotazioni:",a)})}
