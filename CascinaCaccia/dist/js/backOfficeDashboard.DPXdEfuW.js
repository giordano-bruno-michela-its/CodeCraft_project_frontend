import"./modulepreload-polyfill.B5Qt9EMX.js";import{c as L,g as M,s as v,d as $}from"./api.D_iSOBMK.js";const i=sessionStorage.getItem("authToken");if(!i)window.location.href="../index.html";else{let D=function(){i&&(console.log(i),$(i))};console.log("ok"),console.log("Token trovato, invio al server...");const p=await L(i);console.log(p);const c=document.getElementById("navbar");if(p.status==200){const a=document.createElement("li"),d=document.createElement("a");d.href="../Pages/dashboard.html",d.textContent="Dashboard",a.appendChild(d),c?.appendChild(a);const m=document.createElement("li"),o=document.createElement("a");o.href="../Pages/registrationUser.html",o.textContent="Registra Nuova Utenza",m.appendChild(o),c?.appendChild(m);const u=document.createElement("li"),t=document.createElement("a");t.href="../Pages/registrationMail.html",t.textContent="Modifica Mail Cascina",u.appendChild(t),c?.appendChild(u)}const f=document.createElement("li"),s=document.createElement("a");s.id="mailLink",s.textContent="Scarica Mail",s.addEventListener("click",D),f.appendChild(s),c?.appendChild(f);const C=document.createElement("li"),E=document.createElement("a");E.href="../Pages/logout.html",E.textContent="Logout",C.appendChild(E),c?.appendChild(C),M(i).then(a=>{const d=document.getElementById("card-container"),m=document.getElementById("card-container-right"),o=document.getElementById("modal"),u=document.querySelector(".close");if(!d||!m){console.error("Uno o entrambi i container per le card non sono stati trovati.");return}Array.isArray(a)?(a.sort((t,n)=>{const g=new Date(t.contactDate);return new Date(n.contactDate).getTime()-g.getTime()}),a.forEach(t=>{if(t.formType==="FORM_BOOKING"){const n=document.createElement("div");n.className="card",n.id=`prenotazione-${t.id}`;const g=document.createElement("h2");g.textContent=`${t.name} ${t.surname}`;const y=document.createElement("p");y.textContent=`Email: ${t.email}`;const I=document.createElement("p"),b=new Date(t.contactDate).toLocaleDateString("it-IT");I.textContent=`Data di contatto: ${b}`,n.appendChild(g),n.appendChild(y),n.appendChild(I),n.addEventListener("click",()=>{o.style.display="block",document.getElementById("modal-title").textContent=`${t.name} ${t.surname}`,document.getElementById("modal-email").textContent=`Email: ${t.email}`,document.getElementById("modal-association").textContent=`Associazione: ${t.association}`,document.getElementById("modal-contact-date").textContent=`Data di contatto: ${b}`,document.getElementById("modal-phone-number").textContent=`Telefono: ${t.phoneNumber}`,document.getElementById("modal-booking-duration").textContent=`Durata prenotazione: ${t.bookingDuration.name} - ${t.bookingDuration.description}`,document.getElementById("modal-age-group").textContent=`Fascia di età: ${t.ageGroup?t.ageGroup:"Non specificata"}`,document.getElementById("modal-guides-quantity").textContent=`Quantità guide: ${t.guidesQuantity}`,document.getElementById("modal-participants-quantity").textContent=`Quantità partecipanti: ${t.participantsQuantity}`,document.getElementById("modal-begin-time").textContent=`Inizio: ${t.beginTime}`,document.getElementById("modal-end-time").textContent=`Fine: ${t.endTime}`;const k=document.getElementById("modal-activity-type");k.innerHTML="",t.activityType.forEach(e=>{const l=document.createElement("p");l.textContent=`Attività: ${e.name}`,k.appendChild(l)}),document.getElementById("modal-additional-info").textContent=`Info aggiuntive: ${t.additionalInfo||"Nessuna"}`;const h=document.getElementById("modal-buttons");h.innerHTML="",t.bookingStatus==="PENDING"?h.innerHTML=`
                            <button id="close-modal">Annulla</button>
                            <button id="confirm-booking">Conferma prenotazione</button>`:t.bookingStatus==="CONFIRMED"&&(h.innerHTML=`
                            <button id="close-modal">Chiudi</button>
                            <button id="cancel-booking">Annulla Prenotazione</button>`),u.addEventListener("click",()=>{o.style.display="none"});function x(){const e=document.getElementById("loading-modal");e&&(e.style.display="flex")}function B(){const e=document.getElementById("loading-modal");e&&(e.style.display="none")}document.getElementById("confirm-booking")?.addEventListener("click",async()=>{o.style.display="none",x(),console.log("aperto1");const e={id:t.id,bookingStatus:"CONFIRMED"};try{await v(e,i),location.reload()}catch(l){console.error("Errore durante la conferma della prenotazione:",l);const r=document.getElementById("text-error");r&&(r.textContent="Si è verificato un errore,  riprova a eseguire l'operazione")}finally{setTimeout(()=>{B()},5e3)}}),document.getElementById("cancel-booking")?.addEventListener("click",async()=>{o.style.display="none",x(),console.log("aperto2");const e={id:t.id,bookingStatus:"PENDING"};try{await v(e,i),location.reload()}catch(l){console.error("Errore durante la conferma della prenotazione:",l);const r=document.getElementById("text-error");r&&(r.textContent="Si è verificato un errore, riprova a eseguire l'operazione")}finally{setTimeout(()=>{B()},5e3)}}),document.getElementById("close-modal")?.addEventListener("click",()=>{o.style.display="none"})}),t.bookingStatus==="PENDING"?d.appendChild(n):t.bookingStatus==="CONFIRMED"&&m.appendChild(n)}})):console.log("I dati ricevuti non sono un array.")}).catch(a=>{console.error("Errore durante il caricamento delle prenotazioni:",a)})}
